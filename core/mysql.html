<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MySQL Provider
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Type providers for SQL server access.">
    <meta name="author" content="Ross McKinlay, Colin Bull">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="../content/style.css" />
    <script type="text/javascript" src="../content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/fsprojects/SQLProvider">github page</a></li>
        </ul>
        <h3 class="muted"><a href="../index.html">SQLProvider</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="MySQL-Provider" class="anchor" href="#MySQL-Provider">MySQL Provider</a></h1>
<h2><a name="Parameters" class="anchor" href="#Parameters">Parameters</a></h2>
<h3><a name="ConnectionString" class="anchor" href="#ConnectionString">ConnectionString</a></h3>
<p>Basic connection string used to connect to MySQL instance; typical connection
string parameters apply here.  See
<a href="https://dev.mysql.com/doc/connector-net/en/connector-net-connection-options.html">MySQL Connector/NET Connection Strings Documentation</a>
for a complete list of connection string options.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">connString</span>  <span class="o">=</span> <span class="s">&quot;Server=localhost;Database=HR;User=root;Password=password&quot;</span>
</code></pre></td>
</tr>
</table>
<p>To deal with some MySQL data connection problems you might want to add some more parameters to connectionstring:
<code>Auto Enlist=false; Convert Zero Datetime=true;</code></p>
<h3><a name="ConnectionStringName" class="anchor" href="#ConnectionStringName">ConnectionStringName</a></h3>
<p>Instead of storing the connection string in the source code, you
can store it in the <code>App.config</code> file.  This is the name of the
connectionString key/value pair stored in App.config (TODO: confirm filename).</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// found in App.config (TODO: confirm)</span>
<span class="k">let</span> <span class="i">connexStringName</span> <span class="o">=</span> <span class="s">&quot;DefaultConnectionString&quot;</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Database-Vendor" class="anchor" href="#Database-Vendor">Database Vendor</a></h3>
<p>Use <code>MYSQL</code> from the <code>FSharp.Data.Sql.Common.DatabaseProviderTypes</code> enumeration.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">dbVendor</span>    <span class="o">=</span> <span class="i">Common</span><span class="o">.</span><span class="i">DatabaseProviderTypes</span><span class="o">.</span><span class="i">MYSQL</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Resolution-Path" class="anchor" href="#Resolution-Path">Resolution Path</a></h3>
<p>Path to search for assemblies containing database vendor specific connections and custom types. Type the path where
<code>Mysql.Data.dll</code> is stored. Both absolute and relative paths are supported.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">resPath</span> <span class="o">=</span> <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">@&quot;/../../../packages/scripts/MySql.Data/lib/net45&quot;</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Individuals-Amount" class="anchor" href="#Individuals-Amount">Individuals Amount</a></h3>
<p>Sets the count of records to load for each table. See <a href="individuals.html">individuals</a> for further info.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">indivAmount</span> <span class="o">=</span> <span class="n">1000</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Use-Option-Types" class="anchor" href="#Use-Option-Types">Use Option Types</a></h3>
<p>If true, F# option types will be used in place of nullable database columns.  If false, you will always receive the default value of the column's type even if it is null in the database.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">useOptTypes</span> <span class="o">=</span> <span class="k">true</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Example" class="anchor" href="#Example">Example</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">sql</span> <span class="o">=</span> <span class="i">SqlDataProvider</span><span class="o">&lt;</span>
                <span class="i">dbVendor</span>,
                <span class="i">connString</span>,
                <span class="i">ResolutionPath</span> <span class="o">=</span> <span class="i">resPath</span>,
                <span class="i">IndividualsAmount</span> <span class="o">=</span> <span class="i">indivAmount</span>,
                <span class="i">UseOptionTypes</span> <span class="o">=</span> <span class="i">useOptTypes</span>,
                <span class="i">Owner</span> <span class="o">=</span> <span class="s">&quot;HR&quot;</span>
            <span class="o">&gt;</span>
<span class="k">let</span> <span class="i">ctx</span> <span class="o">=</span> <span class="i">sql</span><span class="o">.</span><span class="i">GetDataContext</span>()

<span class="k">let</span> <span class="i">employees</span> <span class="o">=</span> 
    <span class="i">ctx</span><span class="o">.</span><span class="i">Hr</span><span class="o">.</span><span class="i">Employees</span> 
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> <span class="i">e</span> <span class="k">-&gt;</span> <span class="i">e</span><span class="o">.</span><span class="i">ColumnValues</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">toList</span>)
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">toList</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Working-with-Type-mappings" class="anchor" href="#Working-with-Type-mappings">Working with Type-mappings</a></h2>
<h3><a name="Basic-types" class="anchor" href="#Basic-types">Basic types</a></h3>
<p>MySql.Data types are not always the ones you have used to in .NET, so here is a little help:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">myEmp</span> <span class="o">=</span> 
    <span class="i">query</span> {
        <span class="k">for</span> <span class="i">jh</span> <span class="k">in</span> <span class="i">ctx</span><span class="o">.</span><span class="i">Hr</span><span class="o">.</span><span class="i">JobHistory</span> <span class="k">do</span>
        <span class="i">where</span> (<span class="i">jh</span><span class="o">.</span><span class="i">Years</span> <span class="o">&gt;</span> <span class="n">10u</span>)
        <span class="i">select</span> (<span class="i">jh</span>)
    } <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">head</span>

<span class="k">let</span> <span class="i">myUint32</span> <span class="o">=</span> <span class="n">10u</span>
<span class="k">let</span> <span class="i">myInt64</span> <span class="o">=</span> <span class="n">10L</span>
<span class="k">let</span> <span class="i">myUInt64</span> <span class="o">=</span> <span class="n">10UL</span>
</code></pre></td>
</tr>
</table>
<h3><a name="System-Guid-Serialization" class="anchor" href="#System-Guid-Serialization">System.Guid Serialization</a></h3>
<p>If you use string column to save a Guid to database, you may want to skip the hyphens ("-")
when serializing them:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">myGuid</span> <span class="o">=</span> <span class="i">System</span><span class="o">.</span><span class="i">Guid</span><span class="o">.</span><span class="i">NewGuid</span>() <span class="c">//e.g. b8fa7880-ce44-4315-8d60-a160e5734c4b</span>

<span class="k">let</span> <span class="i">myGuidAsString</span> <span class="o">=</span> <span class="i">myGuid</span><span class="o">.</span><span class="i">ToString</span>(<span class="s">&quot;N&quot;</span>) <span class="c">// e.g. &quot;b8fa7880ce4443158d60a160e5734c4b&quot;</span>
</code></pre></td>
</tr>
</table>
<p>The problem with this is that you should never forgot to use "N" in anywhere.</p>
<h3><a name="System-DateTime-Serialization" class="anchor" href="#System-DateTime-Serialization">System.DateTime Serialization</a></h3>
<p>Another problem with MySql.Data is that DateTime conversions may fail if your culture is
not the expected one.</p>
<p>So you may have to convert datetimes as strings instead of using just <code>myEmp.BirthDate &lt;- DateTime.UtcNow</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">myEmp</span><span class="o">.</span><span class="i">SetColumn</span>(<span class="s">&quot;BirthDate&quot;</span>, <span class="i">DateTime</span><span class="o">.</span><span class="i">UtcNow</span><span class="o">.</span><span class="i">ToString</span>(<span class="s">&quot;yyyy-MM-dd HH\:mm\:ss&quot;</span>) <span class="o">|&gt;</span> <span class="i">box</span>)
</code></pre></td>
</tr>
</table>
<p>Notice that if you use <code>.ToString("s")</code> there will be "T" between date and time: "yyyy-MM-ddTHH\:mm\:ss".
And comparing two datetimes as strings with "T" and without "T" will generate a problem with the time-part.</p>
<p>If your DateTime columns are strings in the database, you can use <code>DateTime.Parse</code> in your where-queries:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">longAgo</span> <span class="o">=</span> <span class="i">DateTime</span><span class="o">.</span><span class="i">UtcNow</span><span class="o">.</span><span class="i">AddYears</span>(<span class="o">-</span><span class="n">5</span>)
<span class="k">let</span> <span class="i">myEmp</span> <span class="o">=</span> 
    <span class="i">query</span> {
        <span class="k">for</span> <span class="i">emp</span> <span class="k">in</span> <span class="i">ctx</span><span class="o">.</span><span class="i">Hr</span><span class="o">.</span><span class="i">Employees</span> <span class="k">do</span>
        <span class="i">where</span> (<span class="i">DateTime</span><span class="o">.</span><span class="i">Parse</span>(<span class="i">emp</span><span class="o">.</span><span class="i">HireDate</span>) <span class="o">&gt;</span> <span class="i">longAgo</span>)
        <span class="i">select</span> (<span class="i">emp</span>)
    } <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">head</span>
</code></pre></td>
</tr>
</table>
<p>You should be fine even with canonical functions like <code>DateTime.Parse(a.MeetStartTime).AddMinutes(10.)</code>.</p>
<h2><a name="Caveats-Additional-Info" class="anchor" href="#Caveats-Additional-Info">Caveats / Additional Info</a></h2>
<p>Check <a href="general.html">General</a>, <a href="parameters.html">Static Parameters</a> and <a href="querying.html">Querying</a> documentation.</p>
<h1><a name="Suppport-for-MySqlConnector" class="anchor" href="#Suppport-for-MySqlConnector">Suppport for MySqlConnector</a></h1>
<p><a href="https://github.com/mysql-net/MySqlConnector">MySqlConnector</a> is alternative driver to use instead of MySql.Data.dll.
It has less features but a lot better performance than the official driver.</p>
<p>You can use it with SQLProvider:
Just remove MySql.Data.dll from your resolutionPath and insert there MySqlConnector.dll instead. (Get the latest from NuGet.)
It uses references to System.Buffers.dll, System.Runtime.InteropServices.RuntimeInformation.dll and System.Threading.Tasks.Extensions.dll
so copy those files also to your referencePath. You can get them from corresponding NuGet packages.</p>
<p>Pocedures and database functions are not supported with MySqlConnector so if you want to use those,
the current solution is to use two different connections to database:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">HRFast</span> <span class="o">=</span> <span class="i">SqlDataProvider</span><span class="o">&lt;</span><span class="i">Common</span><span class="o">.</span><span class="i">DatabaseProviderTypes</span><span class="o">.</span><span class="i">MYSQL</span>, <span class="i">connString</span>, <span class="i">ResolutionPath</span> <span class="o">=</span> <span class="s">@&quot;c:\mysqlConnectorPath&quot;</span>, <span class="i">Owner</span> <span class="o">=</span> <span class="s">&quot;HR&quot;</span><span class="o">&gt;</span>
<span class="k">type</span> <span class="i">HRProcs</span> <span class="o">=</span> <span class="i">SqlDataProvider</span><span class="o">&lt;</span><span class="i">Common</span><span class="o">.</span><span class="i">DatabaseProviderTypes</span><span class="o">.</span><span class="i">MYSQL</span>, <span class="i">connString</span>, <span class="i">ResolutionPath</span> <span class="o">=</span> <span class="s">@&quot;c:\MysqlDataPath&quot;</span>, <span class="i">Owner</span> <span class="o">=</span> <span class="s">&quot;HR&quot;</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Example-performance-difference-from-our-unit-tests" class="anchor" href="#Example-performance-difference-from-our-unit-tests">Example performance difference from our unit tests</a></h3>
<p>One complex query:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">MySql</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">dll</span><span class="o">:</span>   <span class="i">Real</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.583</span>, <span class="i">CPU</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.484</span>, <span class="i">GC</span> <span class="i">gen0</span><span class="o">:</span> <span class="n">1</span>, <span class="i">gen1</span><span class="o">:</span> <span class="n">0</span>, <span class="i">gen2</span><span class="o">:</span> <span class="n">0</span>
<span class="i">MySqlConnect</span><span class="o">.</span><span class="i">dll</span><span class="o">:</span> <span class="i">Real</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.173</span>, <span class="i">CPU</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.093</span>, <span class="i">GC</span> <span class="i">gen0</span><span class="o">:</span> <span class="n">1</span>, <span class="i">gen1</span><span class="o">:</span> <span class="n">0</span>, <span class="i">gen2</span><span class="o">:</span> <span class="n">0</span>
</code></pre></td>
</tr>
</table>
<p>Lot of async queries:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">MySQL</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">dll</span>    <span class="i">Real</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">01.425</span>, <span class="i">CPU</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">02.078</span>, <span class="i">GC</span> <span class="i">gen0</span><span class="o">:</span> <span class="n">16</span>, <span class="i">gen1</span><span class="o">:</span> <span class="n">1</span>, <span class="i">gen2</span><span class="o">:</span> <span class="n">0</span>
<span class="i">MySqlConnect</span><span class="o">.</span><span class="i">dll</span><span class="o">:</span> <span class="i">Real</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">01.091</span>, <span class="i">CPU</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">02.000</span>, <span class="i">GC</span> <span class="i">gen0</span><span class="o">:</span> <span class="n">14</span>, <span class="i">gen1</span><span class="o">:</span> <span class="n">1</span>, <span class="i">gen2</span><span class="o">:</span> <span class="n">0</span>
</code></pre></td>
</tr>
</table>


        </div>
        <div class="span3">
          <ul class="nav nav-list" id="menu">
            <li class="nav-header">SQLProvider</li>
            <li><a href="../index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/SQLProvider">Get Library via NuGet</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider/blob/master/LICENSE.txt">License</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
        
            <li class="nav-header">Documentation</li>
              <li><a href="../core/general.html">General</a></li>
              <li><a href="../core/parameters.html">Static Parameters</a></li>
              <li><a href="../core/querying.html">Querying</a></li>
              <li><a href="../core/constraints-relationships.html">Constraints & Relationships</a></li>
              <li><a href="../core/crud.html">CRUD</a></li>
              <li><a href="../core/programmability.html">Programmability</a></li>
              <li><a href="../core/individuals.html">Individuals</a></li>
              <li><a href="../core/composable.html">Composable Query</a></li>
              <li><a href="../core/mssql.html">SQL Server</a></li>
              <li><a href="../core/oracle.html">Oracle</a></li>
              <li><a href="../core/sqlite.html">SQLite</a></li>
              <li><a href="../core/postgresql.html">PostgreSQL</a></li>
              <li><a href="../core/mysql.html">MySQL</a></li>
              <li><a href="../core/odbc.html">ODBC</a></li>
              <li><a href="../reference/index.html">Internal API Docs</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsprojects/SQLProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>
